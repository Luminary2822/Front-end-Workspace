<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta name="renderer" content="webkit" />
    <meta name="force-rendering" content="webkit" />
    <!-- 解决部分兼容性问题，如果安装了GCF，则使用GCF来渲染页面，如果未安装GCF，则使用最高版本的IE内核进行渲染。 -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>领导评价窗口</title>
    <link href="../style/bootstrap.min.css" rel="stylesheet">
    <link href="../style/score_list.min.css" rel="stylesheet">
    <script src="../scripts/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script type="text/javascript" src="../scripts/bootstrap.min.js"></script>
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- 上传前 -->
    <!--<link rel="stylesheet" href="../static/style/bootstrap.min.css">
    <link href="../static/style/score_list.min.css" rel="stylesheet">-->
    <script>
        $(function(){
            if(!!window.ActiveXObject||"ActiveXObject" in window){
                alert("提示: 您在使用的浏览器内核版本可能导致浏览异常。\n" +
                    "\n" +
                    "解决方法（任选其一）：\n" +
                    "请切换到当前浏览器的极速模式\n" +
                    "请安装Chrome(谷歌浏览器）、Firefox（火狐）浏览器、QQ浏览器、搜狐浏览器、360浏览器来使用本系统\n")
            }
            // var img_down = $(".img_down").indexOf(".img_down");
            $(".img_down").click(
                function(){
                    if($(".list_box").eq($(".img_down").index($(this)[0])).css("display")=='none'){
                        $(".list_box").eq($(".img_down").index($(this)[0])).slideDown(500);
                    }else{
                        $(".list_box").eq($(".img_down").index($(this)[0])).slideUp(500);
                    }
                });
        });
    </script>
</head>

<body>
    <div class="container-fluid">

        <div class="header">
            <label class="header_name">高安市2018年下半年“双优”工作满意度评价</label>
        </div>
        <div class="content" style="position: relative;margin-bottom: 50px;height: auto;">
            <button id="save" type="button" class="confirm confirm2" onclick="save();">保存</button>
            <ol class="breadcrumb show_location">
                <li><a href="/">首页</a></li>
                <li class="active">领导评价窗口</li>
            </ol>
            <div>
                <p class="list_text" style="margin-bottom:0;color: #C50001;">尊敬的各位领导：2018年全市各地各部门各单位的优化环境优质服务（简称“双优”）工作如何？请您来评价。
                </p>
                <p class="list_text" style="margin-bottom: 0">1、主要对全市23个乡镇（街道）、38个行政服务（窗口）类单位、38个服务社会类单位、3个园区、37个条管单位的2018年下半年“双优”工作进行评价。
                </p>
                <p class="list_text" style="margin-bottom: 0">2、评价档次分为：非常满意（90分以上），满意（80分以上），一般（70分以上)，不了解(60分)，不满意(50分以下)。
                </p>
                <p class="list_text">非常感谢您的热情参与，祝您身体健康、 工作顺利！
                </p>
            </div>
            <!--乡镇（街道)-->
            <div class="menu">
                <div class="row box_border">
                    <div class="split to_left">
                        <hr class="line to_right" />
                    </div>
                    <div class="mid_box">
                        <div>
                            <strong class="unit">乡镇（街道）</strong>
                            <img src="../images/down.png" alt="" class="img_down">
                        </div>
                    </div>
                    <div class="split to_left">
                        <hr class="line to_left" />
                    </div>
                </div>
                <div class="list_box">
                    <ul class="list-group">
                        <li href="#" class="list-group-item le_list_height" th:each="unit:${orgType1}">
                            <span class="red_point to_left" style="float: left;"> </span>
                            <span class="list_span" th:text="${unit.org_name}">单位详情单位详情单位详情</span>
                            <br>
                            <span class="get_score_lead">
                                <div class="btn-group grade_radio" data-toggle="buttons" th:id="${unit.org_id}">
                                    <input type="radio" value="100" th:name="${unit.org_name}"> 非常满意
                                    <input type="radio" value="85" th:name="${unit.org_name}"> 满意
                                    <input type="radio" value="70" th:name="${unit.org_name}"> 一般
                                    <input type="radio" value="40" th:name="${unit.org_name}"> 不满意
                                    <input type="radio" value="60" th:name="${unit.org_name}"> 不了解
                                </div>
                            </span>
                            <br>
                            <a th:href="@{'/org/'+${unit.org_id}+'.html'}" target="_blank">
                                <button class="badge btn_shadow">单位详情</button>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <!--行政服务（窗口）类单位-->
            <div class="menu">
                <div class="row box_border">
                    <div class="split right_line to_left">
                        <hr class="line to_right" />
                    </div>
                    <div class="mid_box">
                        <div style="">
                            <strong class="unit">行政服务（窗口）类单位</strong>
                            <img src="../images/down.png" alt="" class="img_down">
                        </div>
                    </div>
                    <div class="split left_line to_left">
                        <hr class="line to_left" />
                    </div>
                </div>
                <div class="list_box">
                    <ul class="list-group">
                        <li href="#" class="list-group-item le_list_height" th:each="unit:${orgType2}">
                            <span class="red_point to_left" style="float: left;"> </span>
                            <span class="list_span" th:text="${unit.org_name}">单位详情单位详情单位详情</span>
                            <br>
                            <span class="get_score_lead">
                                <div class="btn-group grade_radio" data-toggle="buttons" th:id="${unit.org_id}">
                                    <input type="radio" value="100" th:name="${unit.org_name}"> 非常满意
                                    <input type="radio" value="85" th:name="${unit.org_name}"> 满意
                                    <input type="radio" value="70" th:name="${unit.org_name}"> 一般
                                    <input type="radio" value="40" th:name="${unit.org_name}"> 不满意
                                    <input type="radio" value="60" th:name="${unit.org_name}"> 不了解
                                </div>
                            </span>
                            <br>
                            <a th:href="@{'/org/'+${unit.org_id}+'.html'}" target="_blank">
                                <button class="badge btn_shadow">单位详情</button>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <!--服务社会类单位-->
            <div class="menu">
                <div class="row box_border">
                    <div class="split right_line to_left">
                        <hr class="line to_right" />
                    </div>
                    <div class="mid_box">
                        <div style="">
                            <strong class="unit">服务社会类单位</strong>
                            <img src="../images/down.png" alt="" class="img_down">
                        </div>
                    </div>
                    <div class="split left_line to_left">
                        <hr class="line to_left" />
                    </div>
                </div>
                <div class="list_box">
                    <ul class="list-group">
                        <li href="#" class="list-group-item le_list_height" th:each="unit:${orgType3}">
                            <span class="red_point to_left" style="float: left;"> </span>
                            <span class="list_span" th:text="${unit.org_name}">单位详情单位详情单位详情</span>
                            <br>
                            <span class="get_score_lead">
                                <div class="btn-group grade_radio" data-toggle="buttons" th:id="${unit.org_id}">
                                    <input type="radio" value="100" th:name="${unit.org_name}"> 非常满意
                                    <input type="radio" value="85" th:name="${unit.org_name}"> 满意
                                    <input type="radio" value="70" th:name="${unit.org_name}"> 一般
                                    <input type="radio" value="40" th:name="${unit.org_name}"> 不满意
                                    <input type="radio" value="60" th:name="${unit.org_name}"> 不了解
                                </div>
                            </span>
                            <br>
                            <a th:href="@{'/org/'+${unit.org_id}+'.html'}" target="_blank">
                                <button class="badge btn_shadow">单位详情</button>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <!--园区-->
            <div class="menu">
                <div class="row box_border">
                    <div class="split right_line to_left">
                        <hr class="line to_right" />
                    </div>
                    <div class="mid_box">
                        <div style="">
                            <strong class="unit">园区</strong>
                            <img src="../images/down.png" alt="" class="img_down">
                        </div>
                    </div>
                    <div class="split left_line to_left">
                        <hr class="line to_left" />
                    </div>
                </div>
                <div class="list_box">
                    <ul class="list-group">
                        <li href="#" class="list-group-item le_list_height" th:each="unit:${orgType5}">
                            <span class="red_point to_left" style="float: left;"> </span>
                            <span class="list_span" th:text="${unit.org_name}">单位详情单位详情单位详情</span>
                            <br>
                            <span class="get_score_lead">
                                <div class="btn-group grade_radio" data-toggle="buttons" th:id="${unit.org_id}">
                                    <input type="radio" value="100" th:name="${unit.org_name}"> 非常满意
                                    <input type="radio" value="85" th:name="${unit.org_name}"> 满意
                                    <input type="radio" value="70" th:name="${unit.org_name}"> 一般
                                    <input type="radio" value="40" th:name="${unit.org_name}"> 不满意
                                    <input type="radio" value="60" th:name="${unit.org_name}"> 不了解
                                </div>
                            </span>
                            <br>
                            <a th:href="@{'/org/'+${unit.org_id}+'.html'}" target="_blank">
                                <button class="badge btn_shadow">单位详情</button>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <!--条管单位-->
            <div class="menu">
                <div class="row box_border">
                    <div class="split right_line to_left">
                        <hr class="line to_right" />
                    </div>
                    <div class="mid_box">
                        <div style="">
                            <strong class="unit">条管单位</strong>
                            <img src="../images/down.png" alt="" class="img_down">
                        </div>
                    </div>
                    <div class="split left_line to_left">
                        <hr class="line to_left" />
                    </div>
                </div>
                <div class="list_box">
                    <ul class="list-group">
                        <li href="#" class="list-group-item le_list_height" th:each="unit:${orgType4    }">
                            <span class="red_point to_left" style="float: left;"> </span>
                            <span class="list_span" th:text="${unit.org_name}">单位详情单位详情单位详情</span>
                            <br>
                            <span class="get_score_lead">
                                <div class="btn-group grade_radio" data-toggle="buttons" th:id="${unit.org_id}">
                                    <input type="radio" value="100" th:name="${unit.org_name}"> 非常满意
                                    <input type="radio" value="85" th:name="${unit.org_name}"> 满意
                                    <input type="radio" value="70" th:name="${unit.org_name}"> 一般
                                    <input type="radio" value="40" th:name="${unit.org_name}"> 不满意
                                    <input type="radio" value="60" th:name="${unit.org_name}"> 不了解
                                </div>
                            </span>
                            <br>
                            <a th:href="@{'/org/'+${unit.org_id}+'.html'}" target="_blank">
                                <button class="badge btn_shadow">单位详情</button>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="input1">
                <span >
                    <!--<button id="save" type="button" class="confirm" onclick="save();" style="margin-right: 15px;margin-left:-120px;">保存</button>-->

                    <button id="grades_submit" type="button" class="confirm">提交</button>
                </span></div>


        </div>
        <div class="footer">
            <span>
                高安市2018年度下半年“双优”工作满意度评价&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                地址：江西省高安市锦惠中路376号&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                邮政编码：330800&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                联系电话：0795-5288156
            </span>
        </div>
    </div>
</body>

<script type="text/javascript" th:inline="javascript">
    var orgType1 = [[${orgType1}]];
    var orgType2 = [[${orgType2}]];
    var orgType3 = [[${orgType3}]];
    var orgType4 = [[${orgType4}]];
    var orgType5 = [[${orgType5}]];
    var account_id = [[${account_id}]];
    var is_score = [[${is_score}]];
    console.log(orgType1);
    console.log(orgType2);
    console.log(orgType3);
    console.log(orgType4);
    console.log(orgType5);
    var org_id = "";
    var flag = 1;
    var count=0;

    function save() {
        var le_history = [];
        window.localStorage.le_formHistory = '';
        $(".grade_radio").each(function () {
            var name = $(this).children().attr("name");
            var val = $('input[name="' + name + '"]:checked').val();
            le_history.push({
                "radio": !isNaN(val) ? val : ''
            })
        });
        window.localStorage.le_formHistory = JSON.stringify(le_history);
        alert("保存成功！");
    }
    $(function () {
        var localMsg;
        if (window.localStorage.le_formHistory) {
            localMsg = JSON.parse(window.localStorage.le_formHistory);
        }
        if (localMsg && localMsg.length >= 1) {
            var realIndex = 0;
            $(".grade_radio").each(function () {
                var val = localMsg[realIndex].radio;
                var name = $(this).children().attr("name");
                $("input[name='" + name + "'][value='" + val + "']").prop("checked", true);
                realIndex++;
            });
        }
    });
    $("#grades_submit").click(function () {
         if(count===1)
        {
            alert("您好，您已经完成了提交，不能再次提交");
            return ;
        }
        var lead_score = [];
        var org_id = [];
        var lead_check = [];


        $(".grade_radio").each(function () {
            var name = $(this).children().attr("name");
            var val = $('input[name="' + name + '"]:checked').val();
            if (val == null) {
                alert("你好，你未对" + name + "单位进行评价，请你对他们评价后再提交，谢谢！");
                flag = 0;
                return false;
            }
            flag = 1;
        });
        if (flag === 1) {
            $("input:radio:checked").each(function () {
                lead_score.push($(this).val());
                org_id.push($(this).parent().attr("id"));
            });
            if (is_score === 1){
                alert("请勿重复打分")
                return ;
            }
          alert("打分成功");
            count=1;
            $.ajax({
                url: "/makeScore/addScore",
                type: "post",
                data: {
                    "lead_score": lead_score,
                    "org_id": org_id,
                    "score_type": 1,
                    "account_id": account_id
                },

                success: function (res) {
                    if (res.code !== 200) {
                        return false;
                    } else {
                        alert("打分成功");

                    }
                },
                error: function () {
                    alert("打分失败");
                    return false;
                }
            });
        }

    })
</script>

</html>